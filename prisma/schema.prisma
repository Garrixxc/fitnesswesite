// ---------- Generators & datasource ----------
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ---------- Enums ----------
enum Role {
  USER
  ADMIN
  ORGANIZER
}

enum Sport {
  RUN
  CYCLING
  SWIM
  TRIATHLON
  TREK
  OTHER
}

enum RegStatus {
  PENDING
  CONFIRMED
  REJECTED
  CANCELLED
  WAITLISTED
}

// ---------- Core models ----------
// ---------- Core models ----------
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  image        String?
  role         Role     @default(USER)
  passwordHash String?

  // Profile fields (migrated from AthleteProfile)
  phone           String?
  city            String?
  state           String?
  country         String?
  gender          String? // simplified from enum for V1
  dob             DateTime?
  tshirtSize      String?
  bloodGroup      String?
  emergencyName   String?
  emergencyPhone  String?
  medicalNotes    String?

  // Relations
  organized     Event[]        @relation("OrganizerEvents")
  registrations Registration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
}

model Event {
  id          String    @id @default(cuid())
  slug        String    @unique
  title       String
  description String
  sport       Sport
  distanceKm  Float?
  startDate   DateTime
  endDate     DateTime?
  location    String
  city        String?
  coverImage  String?
  currency    String    @default("INR")
  price       Int       @default(0)
  capacity    Int?

  organizerId String?
  organizer   User?   @relation("OrganizerEvents", fields: [organizerId], references: [id])

  registrations Registration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sport, startDate])
  @@index([location])
  @@index([organizerId])
  @@index([city, sport])
}

model Registration {
  id         String    @id @default(cuid())
  userId     String
  eventId    String
  status     RegStatus @default(PENDING)
  bibNumber  String?
  paymentRef String?

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, eventId])
  @@index([status])
}
