generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(cuid())
  email         String          @unique
  name          String?
  image         String?
  role          Role            @default(USER)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  profiles      AthleteProfile?
  events        Event[]         @relation("OrganizerEvents")
  registrations Registration[]
  Review        Review[]
  subscriptions Subscription[]
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Event {
  id            String         @id @default(cuid())
  title         String
  slug          String         @unique
  sport         Sport
  distanceKm    Float?
  startDate     DateTime
  endDate       DateTime?
  location      String
  addressJson   Json?
  description   String
  coverImage    String?
  organizerId   String
  price         Int            @default(0)
  currency      String         @default("INR")
  capacity      Int?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  brochureUrl   String?
  organizer     User           @relation("OrganizerEvents", fields: [organizerId], references: [id])
  registrations Registration[]
  reviews       Review[]

  @@index([startDate])
  @@index([sport])
}

model Registration {
  id        String    @id @default(cuid())
  userId    String
  eventId   String
  bibNumber String?
  status    RegStatus @default(PAID)
  paymentId String?
  createdAt DateTime  @default(now())
  event     Event     @relation(fields: [eventId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([userId, eventId], name: "userId_eventId")
}

model TrainingPlan {
  id             String    @id @default(cuid())
  title          String
  slug           String    @unique
  sport          Sport
  level          Level
  weeks          Int
  price          Int       @default(0)
  currency       String    @default("INR")
  isPremium      Boolean   @default(false)
  description    String
  coverImage     String?
  createdAt      DateTime  @default(now())
  compareAtPrice Int?
  updatedAt      DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  workouts       Workout[]
}

model Workout {
  id             String       @id @default(cuid())
  trainingPlanId String
  week           Int
  dayOfWeek      Int
  title          String
  details        String
  trainingPlan   TrainingPlan @relation(fields: [trainingPlanId], references: [id])
}

model Subscription {
  id               String    @id @default(cuid())
  userId           String
  stripeId         String    @unique
  status           SubStatus
  createdAt        DateTime  @default(now())
  currentPeriodEnd DateTime
  user             User      @relation(fields: [userId], references: [id])
}

model Review {
  id        String   @id @default(cuid())
  eventId   String
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  event     Event    @relation(fields: [eventId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model AthleteProfile {
  id       String    @id @default(cuid())
  userId   String    @unique
  dob      DateTime?
  heightCm Int?
  weightKg Float?
  city     String?
  goals    String?
  injuries String?
  user     User      @relation(fields: [userId], references: [id])
}

model Coach {
  id             String   @id @default(cuid())
  slug           String   @unique
  name           String
  photoUrl       String?
  city           String?
  yearsExp       Int      @default(0)
  bio            String?
  certifications String?
  sports         Sport[]
  monthlyRate    Int      @default(0)
  rating         Float?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Club {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  logoUrl     String?
  coverImage  String?
  city        String?
  sports      Sport[]
  memberCount Int      @default(0)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Expert {
  id             String     @id @default(dbgenerated("gen_random_uuid()"))
  slug           String     @unique
  name           String
  role           ExpertRole
  sports         Sport[]
  city           String?
  bio            String?
  certifications String?
  photourl       String?
  hourlyrate     Int?
  monthlyrate    Int?
  rating         Float?
  createdAt      DateTime   @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime   @default(now()) @updatedAt @db.Timestamptz(6)
}

enum Role {
  USER
  ORGANIZER
  ADMIN
}

enum Sport {
  RUN
  CYCLING
  SWIM
  TRIATHLON
  TREK
  OTHER
}

enum RegStatus {
  PENDING
  PAID
  CANCELLED
}

enum Level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum SubStatus {
  ACTIVE
  PAST_DUE
  CANCELED
}

enum ExpertRole {
  COACH
  PHYSIO
  NUTRITION
}
